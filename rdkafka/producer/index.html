<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `producer` mod in crate `rdkafka`."><meta name="keywords" content="rust, rustlang, rust-lang, producer"><title>rdkafka::producer - Rust</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled ><script id="default-settings"></script><script src="../../storage.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../../favicon.svg">
<link rel="alternate icon" type="image/png" href="../../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../../rdkafka/index.html'><div class='logo-container rust-logo'><img src='../../rust-logo.png' alt='logo'></div></a><p class="location">Module producer</p><div class="sidebar-elems"><div class="block items"><ul><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#traits">Traits</a></li><li><a href="#types">Type Definitions</a></li></ul></div><p class="location"><a href="../index.html">rdkafka</a></p><script>window.sidebarCurrent = {name: "producer", ty: "mod", relpath: "../"};</script><script defer src="../sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu"><img src="../../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices" role="menu"></div></div><script src="../../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" class="help-button">?</button>
                <a id="settings-menu" href="../../settings.html"><img src="../../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../src/rdkafka/producer/mod.rs.html#1-370" title="goto source code">[src]</a></span><span class="in-band">Module <a href="../index.html">rdkafka</a>::<wbr><a class="mod" href="">producer</a></span></h1><div class="docblock"><p>Kafka producers.</p>
<h2 id="the-c-librdkafka-producer" class="section-header"><a href="#the-c-librdkafka-producer">The C librdkafka producer</a></h2>
<p>Rust-rdkafka relies on the C librdkafka producer to communicate with Kafka,
so in order to understand how the Rust producers work it is important to
understand the basics of the C one as well.</p>
<h3 id="async" class="section-header"><a href="#async">Async</a></h3>
<p>The librdkafka producer is completely asynchronous: it maintains a memory
buffer where messages waiting to be sent or currently in flight are stored.
Once a message is delivered or an error occurred and the maximum number of
retries has been reached, the producer will enqueue a delivery event with
the appropriate delivery result into an internal event queue.</p>
<p>The librdkafka user is responsible for calling the <code>poll</code> function at
regular intervals to process those events; the thread calling <code>poll</code> will be
the one executing the user-specified delivery callback for every delivery
event. If <code>poll</code> is not called, or not frequently enough, the producer will
return a <a href="../../rdkafka/error/enum.RDKafkaErrorCode.html#variant.QueueFull"><code>RDKafkaErrorCode::QueueFull</code></a> error and it won't be able to send
any other message until more delivery event are processed via <code>poll</code>. The
<code>QueueFull</code> error can also be returned if Kafka is not able to receive the
messages quickly enough.</p>
<h3 id="error-reporting" class="section-header"><a href="#error-reporting">Error reporting</a></h3>
<p>The C library will try deal with all the transient errors such as broker
disconnection, timeouts etc. These errors, called global errors, are
automatically logged in rust-rdkafka, but they normally don't require any
handling as they are automatically handled internally. To see the logs, make
sure you initialize the logger.</p>
<p>As mentioned earlier, errors specific to message production will be reported
in the delivery callback.</p>
<h3 id="buffering" class="section-header"><a href="#buffering">Buffering</a></h3>
<p>Buffering is done automatically by librdkafka. When <code>send</code> is called, the
message is enqueued internally and once enough messages have been enqueued,
or when enough time has passed, they will be sent to Kafka as a single
batch. You can control the behavior of the buffer by configuring the the
<code>queue.buffering.max.*</code> parameters listed below.</p>
<h2 id="rust-rdkafka-producers" class="section-header"><a href="#rust-rdkafka-producers"><code>rust-rdkafka</code> producers</a></h2>
<p><code>rust-rdkafka</code> (rdkafka for brevity) provides two sets of producers: low
level and high level.</p>
<h3 id="low-level-producers" class="section-header"><a href="#low-level-producers">Low-level producers</a></h3>
<p>The lowest level producer provided by rdkafka is called <a href="../../rdkafka/producer/struct.BaseProducer.html" title="BaseProducer"><code>BaseProducer</code></a>.
The goal of the <code>BaseProducer</code> is to be as close as possible to the C one
while maintaining a safe Rust interface. In particular, the <code>BaseProducer</code>
needs to be polled at regular intervals to execute any delivery callback
that might be waiting and to make sure the queue doesn't fill up.</p>
<p>Another low lever producer is the <a href="../../rdkafka/producer/struct.ThreadedProducer.html" title="ThreadedProducer"><code>ThreadedProducer</code></a>, which is a
<code>BaseProducer</code> with a dedicated thread for polling.</p>
<p>The delivery callback can be defined using a <code>ProducerContext</code>. See the
<a href="../../rdkafka/producer/base_producer/index.html" title="base_producer"><code>base_producer</code></a> module for more information.</p>
<h3 id="high-level-producer" class="section-header"><a href="#high-level-producer">High-level producer</a></h3>
<p>At the moment the only high level producer implemented is the
<a href="../../rdkafka/producer/struct.FutureProducer.html" title="FutureProducer"><code>FutureProducer</code></a>. The <code>FutureProducer</code> doesn't rely on user-defined
callbacks to notify the delivery or failure of a message; instead, this
information will be returned in a Future. The <code>FutureProducer</code> also uses an
internal thread that is used for polling, which makes calling poll
explicitly not necessary. The returned future will contain information about
the delivered message in case of success, or a copy of the original message
in case of failure. Additional computation can be chained to the returned
future, and it will executed by the future executor once the value is
available (for more information, check the documentation of the futures
crate).</p>
<h2 id="transactions" class="section-header"><a href="#transactions">Transactions</a></h2>
<p>All rust-rdkafka producers support transactions. Transactional producers
work together with transaction-aware consumers configured with the default
<code>isolation.level</code> of <code>read_committed</code>.</p>
<p>To configure a producer for transactions set <code>transactional.id</code> to an
identifier unique to the application when creating the producer. After
creating the producer, you must initialize it with
<a href="../../rdkafka/producer/trait.Producer.html#tymethod.init_transactions" title="Producer::init_transactions"><code>Producer::init_transactions</code></a>.</p>
<p>To start a new transaction use <a href="../../rdkafka/producer/trait.Producer.html#tymethod.begin_transaction" title="Producer::begin_transaction"><code>Producer::begin_transaction</code></a>. There can be
<strong>only one ongoing transaction</strong> at a time per producer. All records sent
after starting a transaction and before committing or aborting it will
automatically be associated with that transaction.</p>
<p>Once you have initialized transactions on a producer, you are not permitted
to produce messages outside of a transaction.</p>
<p>Consumer offsets can be sent as part of the ongoing transaction using
<code>send_offsets_to_transaction</code> and will be committed atomically with the
other records sent in the transaction.</p>
<p>The current transaction can be committed with
<a href="../../rdkafka/producer/trait.Producer.html#tymethod.commit_transaction" title="Producer::commit_transaction"><code>Producer::commit_transaction</code></a> or aborted using
<a href="../../rdkafka/producer/trait.Producer.html#tymethod.abort_transaction" title="Producer::abort_transaction"><code>Producer::abort_transaction</code></a>. Afterwards, a new transaction can begin.</p>
<h3 id="errors" class="section-header"><a href="#errors">Errors</a></h3>
<p>Errors returned by transaction methods may:</p>
<ul>
<li>be retriable (<a href="../../rdkafka/error/struct.RDKafkaError.html#method.is_retriable"><code>RDKafkaError::is_retriable</code></a>), in which case the operation
that encountered the error may be retried.</li>
<li>require abort (<a href="../../rdkafka/error/struct.RDKafkaError.html#method.txn_requires_abort"><code>RDKafkaError::txn_requires_abort</code></a>, in which case the
current transaction must be aborted and a new transaction begun.</li>
<li>be fatal (<a href="../../rdkafka/error/struct.RDKafkaError.html#method.is_fatal"><code>RDKafkaError::is_fatal</code></a>), in which case the producer must be
stopped and the application terminated.</li>
</ul>
<p>For more details about transactions, see the <a href="https://github.com/edenhill/librdkafka/blob/master/INTRODUCTION.md#transactional-producer">Transactional Producer</a>
section of the librdkafka introduction.</p>
<h2 id="configuration" class="section-header"><a href="#configuration">Configuration</a></h2><h3 id="producer-configuration" class="section-header"><a href="#producer-configuration">Producer configuration</a></h3>
<p>For the configuration parameters common to both producers and consumers,
refer to the documentation in the <code>config</code> module. Here are listed the most
commonly used producer configuration. Click
<a href="https://github.com/edenhill/librdkafka/blob/master/CONFIGURATION.md">here</a>
for the full list.</p>
<ul>
<li><code>queue.buffering.max.messages</code>: Maximum number of messages allowed on the
producer queue. Default: 100000.</li>
<li><code>queue.buffering.max.kbytes</code>: Maximum total message size sum allowed on
the producer queue. This property has higher priority than
queue.buffering.max.messages. Default: 4000000.</li>
<li><code>queue.buffering.max.ms</code>: Delay in milliseconds to wait for messages in
the producer queue to accumulate before sending a request to the brokers.
A higher value allows larger and more effective (less overhead, improved
compression) batches of messages to accumulate at the expense of increased
message delivery latency. Default: 0.</li>
<li><code>message.send.max.retries</code>: How many times to retry sending a failing
batch. Note: retrying may cause reordering. Default: 2.</li>
<li><code>compression.codec</code>: Compression codec to use for compressing message
sets. Default: none.</li>
<li><code>request.required.acks</code>: This field indicates how many acknowledgements
the leader broker must receive from ISR brokers before responding to the
request: 0=Broker does not send any response/ack to client, 1=Only the
leader broker will need to ack the message, -1 or all=broker will block
until message is committed by all in sync replicas (ISRs) or broker's
in.sync.replicas setting before sending response. Default: 1.</li>
<li><code>request.timeout.ms</code>: The ack timeout of the producer request in
milliseconds. This value is only enforced by the broker and relies on
request.required.acks being != 0. Default: 5000.</li>
<li><code>message.timeout.ms</code>: Local message timeout. This value is only enforced
locally and limits the time a produced message waits for successful
delivery. A time of 0 is infinite. Default: 300000.</li>
</ul>
</div><h2 id="modules" class="section-header"><a href="#modules">Modules</a></h2>
<table><tr class="module-item"><td><a class="mod" href="base_producer/index.html" title="rdkafka::producer::base_producer mod">base_producer</a></td><td class="docblock-short"><p>Low-level Kafka producers.</p>
</td></tr><tr class="module-item"><td><a class="mod" href="future_producer/index.html" title="rdkafka::producer::future_producer mod">future_producer</a></td><td class="docblock-short"><p>High-level, futures-enabled Kafka producer.</p>
</td></tr></table><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<table><tr class="module-item"><td><a class="struct" href="struct.BaseProducer.html" title="rdkafka::producer::BaseProducer struct">BaseProducer</a></td><td class="docblock-short"><p>Lowest level Kafka producer.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.BaseRecord.html" title="rdkafka::producer::BaseRecord struct">BaseRecord</a></td><td class="docblock-short"><p>A record for the <a href="../../rdkafka/producer/struct.BaseProducer.html" title="BaseProducer"><code>BaseProducer</code></a> and <a href="../../rdkafka/producer/struct.ThreadedProducer.html" title="ThreadedProducer"><code>ThreadedProducer</code></a>.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.DefaultProducerContext.html" title="rdkafka::producer::DefaultProducerContext struct">DefaultProducerContext</a></td><td class="docblock-short"><p>An inert producer context that can be used when customizations are not
required.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.DeliveryFuture.html" title="rdkafka::producer::DeliveryFuture struct">DeliveryFuture</a></td><td class="docblock-short"><p>A <a href="https://doc.rust-lang.org/nightly/core/future/future/trait.Future.html" title="Future"><code>Future</code></a> wrapping the result of the message production.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.FutureProducer.html" title="rdkafka::producer::FutureProducer struct">FutureProducer</a></td><td class="docblock-short"><p>A producer that returns a <a href="https://doc.rust-lang.org/nightly/core/future/future/trait.Future.html" title="Future"><code>Future</code></a> for every message being produced.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.FutureRecord.html" title="rdkafka::producer::FutureRecord struct">FutureRecord</a></td><td class="docblock-short"><p>A record for the future producer.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.ThreadedProducer.html" title="rdkafka::producer::ThreadedProducer struct">ThreadedProducer</a></td><td class="docblock-short"><p>A low-level Kafka producer with a separate thread for event handling.</p>
</td></tr></table><h2 id="traits" class="section-header"><a href="#traits">Traits</a></h2>
<table><tr class="module-item"><td><a class="trait" href="trait.Producer.html" title="rdkafka::producer::Producer trait">Producer</a></td><td class="docblock-short"><p>Common trait for all producers.</p>
</td></tr><tr class="module-item"><td><a class="trait" href="trait.ProducerContext.html" title="rdkafka::producer::ProducerContext trait">ProducerContext</a></td><td class="docblock-short"><p>Producer-specific context.</p>
</td></tr></table><h2 id="types" class="section-header"><a href="#types">Type Definitions</a></h2>
<table><tr class="module-item"><td><a class="type" href="type.DeliveryResult.html" title="rdkafka::producer::DeliveryResult type">DeliveryResult</a></td><td class="docblock-short"><p>The result of a message production.</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../../";window.currentCrate = "rdkafka";</script><script src="../../main.js"></script><script defer src="../../search-index.js"></script></body></html>