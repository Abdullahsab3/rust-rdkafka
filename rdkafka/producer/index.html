<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Kafka producers."><meta name="keywords" content="rust, rustlang, rust-lang, producer"><title>rdkafka::producer - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../../dark.css" disabled><link rel="stylesheet" type="text/css" href="../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../storage.js"></script><script src="../../crates.js"></script><script defer src="../../main.js"></script>
    <noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../rdkafka/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../../rdkafka/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"><a href="#">Module producer</a></h2><div class="sidebar-elems"><div class="block items"><ul><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#traits">Traits</a></li><li><a href="#types">Type Definitions</a></li></ul></div><div id="sidebar-vars" data-name="producer" data-ty="mod" data-relpath="./"></div><script defer src="./sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../rdkafka/index.html"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></a><nav class="sub"><div class="theme-picker hidden"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><div>
                                <input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Module <a href="../index.html">rdkafka</a>::<wbr><a class="mod" href="#">producer</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../../src/rdkafka/producer/mod.rs.html#1-370" title="goto source code">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Kafka producers.</p>
<h3 id="the-c-librdkafka-producer" class="section-header"><a href="#the-c-librdkafka-producer">The C librdkafka producer</a></h3>
<p>Rust-rdkafka relies on the C librdkafka producer to communicate with Kafka,
so in order to understand how the Rust producers work it is important to
understand the basics of the C one as well.</p>
<h4 id="async" class="section-header"><a href="#async">Async</a></h4>
<p>The librdkafka producer is completely asynchronous: it maintains a memory
buffer where messages waiting to be sent or currently in flight are stored.
Once a message is delivered or an error occurred and the maximum number of
retries has been reached, the producer will enqueue a delivery event with
the appropriate delivery result into an internal event queue.</p>
<p>The librdkafka user is responsible for calling the <code>poll</code> function at
regular intervals to process those events; the thread calling <code>poll</code> will be
the one executing the user-specified delivery callback for every delivery
event. If <code>poll</code> is not called, or not frequently enough, the producer will
return a <a href="../types/enum.RDKafkaErrorCode.html#variant.QueueFull"><code>RDKafkaErrorCode::QueueFull</code></a> error and it won’t be able to send
any other message until more delivery events are processed via <code>poll</code>. The
<code>QueueFull</code> error can also be returned if Kafka is not able to receive the
messages quickly enough.</p>
<h4 id="error-reporting" class="section-header"><a href="#error-reporting">Error reporting</a></h4>
<p>The C library will try deal with all the transient errors such as broker
disconnection, timeouts etc. These errors, called global errors, are
automatically logged in rust-rdkafka, but they normally don’t require any
handling as they are automatically handled internally. To see the logs, make
sure you initialize the logger.</p>
<p>As mentioned earlier, errors specific to message production will be reported
in the delivery callback.</p>
<h4 id="buffering" class="section-header"><a href="#buffering">Buffering</a></h4>
<p>Buffering is done automatically by librdkafka. When <code>send</code> is called, the
message is enqueued internally and once enough messages have been enqueued,
or when enough time has passed, they will be sent to Kafka as a single
batch. You can control the behavior of the buffer by configuring the the
<code>queue.buffering.max.*</code> parameters listed below.</p>
<h3 id="rust-rdkafka-producers" class="section-header"><a href="#rust-rdkafka-producers"><code>rust-rdkafka</code> producers</a></h3>
<p><code>rust-rdkafka</code> (rdkafka for brevity) provides two sets of producers: low
level and high level.</p>
<h4 id="low-level-producers" class="section-header"><a href="#low-level-producers">Low-level producers</a></h4>
<p>The lowest level producer provided by rdkafka is called <a href="struct.BaseProducer.html" title="BaseProducer"><code>BaseProducer</code></a>.
The goal of the <code>BaseProducer</code> is to be as close as possible to the C one
while maintaining a safe Rust interface. In particular, the <code>BaseProducer</code>
needs to be polled at regular intervals to execute any delivery callback
that might be waiting and to make sure the queue doesn’t fill up.</p>
<p>Another low lever producer is the <a href="struct.ThreadedProducer.html" title="ThreadedProducer"><code>ThreadedProducer</code></a>, which is a
<code>BaseProducer</code> with a dedicated thread for polling.</p>
<p>The delivery callback can be defined using a <code>ProducerContext</code>. See the
<a href="base_producer/index.html" title="base_producer"><code>base_producer</code></a> module for more information.</p>
<h4 id="high-level-producer" class="section-header"><a href="#high-level-producer">High-level producer</a></h4>
<p>At the moment the only high level producer implemented is the
<a href="struct.FutureProducer.html" title="FutureProducer"><code>FutureProducer</code></a>. The <code>FutureProducer</code> doesn’t rely on user-defined
callbacks to notify the delivery or failure of a message; instead, this
information will be returned in a Future. The <code>FutureProducer</code> also uses an
internal thread that is used for polling, which makes calling poll
explicitly not necessary. The returned future will contain information about
the delivered message in case of success, or a copy of the original message
in case of failure. Additional computation can be chained to the returned
future, and it will executed by the future executor once the value is
available (for more information, check the documentation of the futures
crate).</p>
<h3 id="transactions" class="section-header"><a href="#transactions">Transactions</a></h3>
<p>All rust-rdkafka producers support transactions. Transactional producers
work together with transaction-aware consumers configured with the default
<code>isolation.level</code> of <code>read_committed</code>.</p>
<p>To configure a producer for transactions set <code>transactional.id</code> to an
identifier unique to the application when creating the producer. After
creating the producer, you must initialize it with
<a href="trait.Producer.html#tymethod.init_transactions" title="Producer::init_transactions"><code>Producer::init_transactions</code></a>.</p>
<p>To start a new transaction use <a href="trait.Producer.html#tymethod.begin_transaction" title="Producer::begin_transaction"><code>Producer::begin_transaction</code></a>. There can be
<strong>only one ongoing transaction</strong> at a time per producer. All records sent
after starting a transaction and before committing or aborting it will
automatically be associated with that transaction.</p>
<p>Once you have initialized transactions on a producer, you are not permitted
to produce messages outside of a transaction.</p>
<p>Consumer offsets can be sent as part of the ongoing transaction using
<code>send_offsets_to_transaction</code> and will be committed atomically with the
other records sent in the transaction.</p>
<p>The current transaction can be committed with
<a href="trait.Producer.html#tymethod.commit_transaction" title="Producer::commit_transaction"><code>Producer::commit_transaction</code></a> or aborted using
<a href="trait.Producer.html#tymethod.abort_transaction" title="Producer::abort_transaction"><code>Producer::abort_transaction</code></a>. Afterwards, a new transaction can begin.</p>
<h4 id="errors" class="section-header"><a href="#errors">Errors</a></h4>
<p>Errors returned by transaction methods may:</p>
<ul>
<li>be retriable (<a href="../error/struct.RDKafkaError.html#method.is_retriable"><code>RDKafkaError::is_retriable</code></a>), in which case the operation
that encountered the error may be retried.</li>
<li>require abort (<a href="../error/struct.RDKafkaError.html#method.txn_requires_abort"><code>RDKafkaError::txn_requires_abort</code></a>, in which case the
current transaction must be aborted and a new transaction begun.</li>
<li>be fatal (<a href="../error/struct.RDKafkaError.html#method.is_fatal"><code>RDKafkaError::is_fatal</code></a>), in which case the producer must be
stopped and the application terminated.</li>
</ul>
<p>For more details about transactions, see the <a href="https://github.com/edenhill/librdkafka/blob/master/INTRODUCTION.md#transactional-producer">Transactional Producer</a>
section of the librdkafka introduction.</p>
<h3 id="configuration" class="section-header"><a href="#configuration">Configuration</a></h3><h4 id="producer-configuration" class="section-header"><a href="#producer-configuration">Producer configuration</a></h4>
<p>For the configuration parameters common to both producers and consumers,
refer to the documentation in the <code>config</code> module. Here are listed the most
commonly used producer configuration. Click
<a href="https://github.com/edenhill/librdkafka/blob/master/CONFIGURATION.md">here</a>
for the full list.</p>
<ul>
<li><code>queue.buffering.max.messages</code>: Maximum number of messages allowed on the
producer queue. Default: 100000.</li>
<li><code>queue.buffering.max.kbytes</code>: Maximum total message size sum allowed on
the producer queue. This property has higher priority than
queue.buffering.max.messages. Default: 4000000.</li>
<li><code>queue.buffering.max.ms</code>: Delay in milliseconds to wait for messages in
the producer queue to accumulate before sending a request to the brokers.
A higher value allows larger and more effective (less overhead, improved
compression) batches of messages to accumulate at the expense of increased
message delivery latency. Default: 0.</li>
<li><code>message.send.max.retries</code>: How many times to retry sending a failing
batch. Note: retrying may cause reordering. Default: 2.</li>
<li><code>compression.codec</code>: Compression codec to use for compressing message
sets. Default: none.</li>
<li><code>request.required.acks</code>: This field indicates how many acknowledgements
the leader broker must receive from ISR brokers before responding to the
request: 0=Broker does not send any response/ack to client, 1=Only the
leader broker will need to ack the message, -1 or all=broker will block
until message is committed by all in sync replicas (ISRs) or broker’s
in.sync.replicas setting before sending response. Default: 1.</li>
<li><code>request.timeout.ms</code>: The ack timeout of the producer request in
milliseconds. This value is only enforced by the broker and relies on
request.required.acks being != 0. Default: 5000.</li>
<li><code>message.timeout.ms</code>: Local message timeout. This value is only enforced
locally and limits the time a produced message waits for successful
delivery. A time of 0 is infinite. Default: 300000.</li>
</ul>
</div></details><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="mod" href="base_producer/index.html" title="rdkafka::producer::base_producer mod">base_producer</a></div><div class="item-right docblock-short"><p>Low-level Kafka producers.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="future_producer/index.html" title="rdkafka::producer::future_producer mod">future_producer</a></div><div class="item-right docblock-short"><p>High-level, futures-enabled Kafka producer.</p>
</div></div></div><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.BaseProducer.html" title="rdkafka::producer::BaseProducer struct">BaseProducer</a></div><div class="item-right docblock-short"><p>Lowest level Kafka producer.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.BaseRecord.html" title="rdkafka::producer::BaseRecord struct">BaseRecord</a></div><div class="item-right docblock-short"><p>A record for the <a href="struct.BaseProducer.html" title="BaseProducer"><code>BaseProducer</code></a> and <a href="struct.ThreadedProducer.html" title="ThreadedProducer"><code>ThreadedProducer</code></a>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.DefaultProducerContext.html" title="rdkafka::producer::DefaultProducerContext struct">DefaultProducerContext</a></div><div class="item-right docblock-short"><p>An inert producer context that can be used when customizations are not
required.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.DeliveryFuture.html" title="rdkafka::producer::DeliveryFuture struct">DeliveryFuture</a></div><div class="item-right docblock-short"><p>A <a href="https://doc.rust-lang.org/nightly/core/future/future/trait.Future.html" title="Future"><code>Future</code></a> wrapping the result of the message production.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.FutureProducer.html" title="rdkafka::producer::FutureProducer struct">FutureProducer</a></div><div class="item-right docblock-short"><p>A producer that returns a <a href="https://doc.rust-lang.org/nightly/core/future/future/trait.Future.html" title="Future"><code>Future</code></a> for every message being produced.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.FutureRecord.html" title="rdkafka::producer::FutureRecord struct">FutureRecord</a></div><div class="item-right docblock-short"><p>A record for the future producer.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ThreadedProducer.html" title="rdkafka::producer::ThreadedProducer struct">ThreadedProducer</a></div><div class="item-right docblock-short"><p>A low-level Kafka producer with a separate thread for event handling.</p>
</div></div></div><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.Producer.html" title="rdkafka::producer::Producer trait">Producer</a></div><div class="item-right docblock-short"><p>Common trait for all producers.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.ProducerContext.html" title="rdkafka::producer::ProducerContext trait">ProducerContext</a></div><div class="item-right docblock-short"><p>Producer-specific context.</p>
</div></div></div><h2 id="types" class="small-section-header"><a href="#types">Type Definitions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="type" href="type.DeliveryResult.html" title="rdkafka::producer::DeliveryResult type">DeliveryResult</a></div><div class="item-right docblock-short"><p>The result of a message production.</p>
</div></div></div></section><section id="search" class="content hidden"></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="rdkafka" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.60.0-nightly (bfe156467 2022-01-22)" ></div>
</body></html>